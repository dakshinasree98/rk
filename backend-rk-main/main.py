from flask import Flask, request, jsonify
import asyncio
import asyncpg
from google import genai
import os
from flask_cors import CORS
from dotenv import load_dotenv

# Load environment variables
load_dotenv()

# Initialize Flask app
app = Flask(__name__)
CORS(app)

# Initialize Gemini client
GEMINI_API_KEY = os.getenv("GEMINI_API_KEY")
client = genai.Client(api_key=GEMINI_API_KEY)

# Neon DB connection parameters
NEON_DB_USER = os.getenv("NEON_DB_USER")
NEON_DB_PASSWORD = os.getenv("NEON_DB_PASSWORD")
NEON_DB_HOST = os.getenv("NEON_DB_HOST")
NEON_DB_PORT = os.getenv("NEON_DB_PORT")
NEON_DB_NAME = os.getenv("NEON_DB_NAME")

# Function to connect to Neon DB
async def connect_to_neon():
    return await asyncpg.connect(
        user=NEON_DB_USER,
        password=NEON_DB_PASSWORD,
        database=NEON_DB_NAME,
        host=NEON_DB_HOST,
        port=NEON_DB_PORT
    )

# Function to log conversation and update summary
async def log_chat_and_update_summary(session_id, new_log_entry, user_query):
    conn = await connect_to_neon()
    try:
        existing_row = await conn.fetchrow(
            "SELECT log, summary FROM chat_logs WHERE session_id = $1", session_id
        )
        
        existing_log = existing_row['log'] if existing_row else ""
        updated_log = f"{existing_log} | {new_log_entry}" if existing_log else new_log_entry
        
        if existing_row:
            await conn.execute("UPDATE chat_logs SET log = $1 WHERE session_id = $2", updated_log, session_id)
        else:
            await conn.execute("INSERT INTO chat_logs (session_id, log, summary) VALUES ($1, $2, $3)", session_id, updated_log, "")

        prompt = (
            f"Based on this chat log: '{updated_log}', provide a concise summary. "
            f"Extract user's name and phone number if available. "
            f"Format: 'User: [name], Phone: [phone], Summary: [conversation summary]'. "
            f"Use 'Unknown' if name or phone number is not found."
        )
        
        summary_response = client.models.generate_content(
            model="gemini-2.0-flash",
            contents=[prompt]
        ).text.strip()
        
        await conn.execute("UPDATE chat_logs SET summary = $1 WHERE session_id = $2", summary_response, session_id)
        return summary_response
    finally:
        await conn.close()

# Function to generate response
async def generate_representative_response(session_id, query):
    conn = await connect_to_neon()
    try:
        row = await conn.fetchrow("SELECT summary FROM chat_logs WHERE session_id = $1", session_id)
        summary = row['summary'] if row else ""
        
        context = "RK Nature Cure HomeAbout RK Nature Cure HomeRK Nature Cure Home is a premier naturopathy center dedicated to healing through the power of nature.Founded in 1984 by Dr.R.Krishnasamy Gounder, it combines traditional wisdom with modern techniques to promote holistic well-being.Our HistoryFoundingRK Nature Cure Home was established on March 4, 1984, by Dr.R.Krishnasamy Gounder, under the blessings of H.H.Swami Satchidananda Maharaj.Inspired by Mahatma Gandhi’s philosophy of natural healing, Dr.Gounder aimed to share the benefits he experienced from nature cure with others.The center began experimentally in 1979 in a small house near its current location in Coimbatore, Tamil Nadu.EvolutionNearly three decades later, RK Nature Cure Home has grown into a leading naturopathy center.Recently renovated to incorporate advanced techniques, it continues to uphold Dr.Gounder’s vision of quality care rooted in traditional healing.The Deluxe and Executive blocks were inaugurated on February 24, 2012, by His Holiness Sree Sakthi Amma of Narayani Peetam, Sreepuram, Vellore.Our Founder: Dr.R.Krishnasamy GounderBorn: September 15, 1907, to devout parents.Early Life: A Tamil scholar and poet, earning the title “Pulavar.”Innovations: Pioneered gobar gas plants, charcoal gas plants for vehicles during WWII, and novel farming techniques.Service: Supported the farming community through agricultural associations and magazines.Turning Point: At age 20, an acute stomach ailment unrelieved by modern medicine led him to Mahatma Gandhi’s book, Key to Health.Practicing its natural healing principles cured him, igniting a lifelong belief in nature’s power.Inspiration: Visited Gandhi’s nature cure center in Uruli Kanchan, Pune, solidifying his resolve to establish RK Nature Cure Home.Our PhilosophyVisionTo create a self-sufficient society that seeks peace and joy in living, enabling individuals to maintain a lifestyle in complete harmony with nature through naturopathy and yoga.MissionProvide holistic naturopathy treatment focusing on mind, body, and spirit.Educate and motivate clients to achieve optimal physical, mental, and emotional health.Employ the best natural healing professionals to facilitate cures and design healthy lifestyle modules.Our ApproachHolistic CareRK Nature Cure Home offers care as an in-patient facility, requiring stays tailored to chronic conditions and specific ailments.The process includes:Comprehensive Assessment: Mental, emotional, physiological, and psychological evaluations.Treatment Modalities: Systematic detoxifying, healing, tonifying, reinforcing, and rejuvenating therapies to restore health harmony.Education and DisciplineCounseling: Sessions on self-evaluation, self-control, and the impacts of unhealthy lifestyles and stress.Follow-Up: Patients are encouraged to adopt regular regimens post-treatment for sustained benefits.Duration: Treatment ranges from one week to several months, depending on age and chronicity, requiring patient conviction and discipline.GoalRe-establish a harmonious bodily environment to restore natural healing capacity and vitality, empowering patients with guidance for healthy lifestyles.Our ServicesRK Nature Cure Home specializes in:Naturopathy Treatment: Holistic care through natural therapies.Innovative Techniques: Recently integrated modern methods alongside traditional practices.Physiotherapy: Recognized for having the best physiotherapists in Coimbatore, enhancing natural recovery.Outcome: Restores well-being and harmony of mind and body with expert care.Our TeamDoctors and StaffThe team comprises:Qualified Professionals: Experienced doctors in Naturopathic Medicine and Yoga.Support Staff: Administrative and support personnel trained for naturopathy’s unique needs.Commitment: Devoted to healing and providing transformative experiences for those seeking relief from ailments.Our Group: Roots Group of CompaniesOverviewBased in Coimbatore, the Roots Group of Companies is a multifaceted entity with a strong presence in:Automotive horns, high-precision engineering components, and auto accessories.Mechanized cleaning equipment, medical and aerospace components, aluminum die casting, alternators, starter motors, tools and dies, ergonomic furniture, and electric vehicles.ReachExports: Europe, UK, USA, Singapore, Middle East, Australia, Japan, and more.Workforce: Employs over 3,500 people directly, supporting small and medium-scale industries.Focus: Safety, quality, performance, and service.StrengthsCapabilities: Captive tooling, product development, precision engineering, and casting.Network: Efficient distributor/dealer operations across India and globally.Innovation: Continuous research and development for product improvisation and customer-centric solutions.Contact DetailsR K NATURE CURE HOMENo.12 Krishna Layout, Ganapathy,Behind Roots Group of Companies,Coimbatore - 641006.+91 88700-666220422 2332111enquiry@rknature.comRK Nature Cure Home: A Trusted Healing CenterRK Nature Cure Home blends ancient wisdom with modern techniques, offering comprehensive, drugless treatments tailored to individual needs.From acupuncture to physiotherapy, the center is committed to holistic health and wellness.Signature TherapiesLeaf Bath: A unique detox therapy where the body is wrapped in plantain leaves and exposed to moderate sunlight, opening skin pores, inducing profuse sweating, and eliminating toxins for rejuvenation.Sun Bath: Controlled sunlight exposure facilitates sweating, removes toxic waste, improves metabolism, boosts Vitamin D, prevents calcium deficiency, alleviates skin diseases, and regulates circadian rhythm.Salt Glow Massage: A cold massage using salt and coconut oil to enhance skin tone, burn calories, and invigorate circulation and metabolism.Packs & Compresses: Hydrotherapy wraps applied to specific areas to correct metabolism, improve circulation, burn fat, enhance liver and kidney function, and reduce pain and inflammation.Herbal & Mud Applications: Uses ingredients like aloe vera, fenugreek, papaya, badam, multani mud, black mud, sweet basil, neem, kadukai, turmeric, curd, guduchi, and kasakasa to treat skin diseases and enhance glow.Massage TypesSwedish Massage: With oils like sesame, aroma, badam, grape seed, olive, coconut, or jojoba.Herbal Powder Scrub Massage: Exfoliates and rejuvenates skin.Poultice Massage: With rock salt and oil, rice husk, or herbal leaves.Fruit Massage: Uses natural fruits for skin nourishment.Aloe Vera Massage: Hydrates and heals skin.Yoga at RK Nature Cure HomeOverviewYoga, an art of living, addresses spirituality, science, and mental and physical health through systematic practices like asanas, kriyas, and pranayama.Daily classes and specific therapy sessions at RK Nature Cure Home target conditions like diabetes, hypertension, menstrual disorders, and thyroid issues.Key PracticesAsanas: Postures with breath awareness stretch and relax muscles and joints, improving circulation, metabolism, and revitalization.Pranayama: Controlled breathing techniques enhance lung volume, attention, and focus, curing physical and mental ailments.Kriyas (Six Types):Kapalabhathi: Cranial cleansing.Trataka: Gazing to improve eye health, concentration, and memory.Neti: Nasal cleansing.Dhouthi: Gastric cleanse (e.g., Vamanam).Nauli: Abdominal massage.Vasti: Colon cleansing.Balances doshas (Vata, Pitta, Kapha) and removes metabolic waste.ENT Wash: Includes Jala Neti (nasal irrigation with saline water) and eyewash to prevent congestion, improve immunity, and cool the system.Lagu Shanka Prakshalana: Cleanses the digestive tract with saline water to improve digestion, absorption, and metabolism.Vamanam: A dhauti kriya (gastric cleanse) to remove stomach toxins, aiding hyperacidity, asthma, and respiratory issues.Mudras: Energy gestures regulate pranic flow to heal acute and chronic illnesses.Mindfulness: Meditation practice improves mental clarity, reduces stress, depression, anxiety, and psychosomatic ailments.Naturopathic Solutions for Specific ConditionsKidney Health: Specialized diets, botanical concoctions, hydrotherapy, acupuncture, and detoxification improve renal function.Weight Reduction: Personalized diets, exercise regimens, and lifestyle changes promote sustainable weight loss.High Blood Pressure: Dietary changes, yoga, hydrotherapy, stress reduction, and lifestyle counseling enhance cardiovascular health.Asthma Management: Breathing exercises, botanicals (tulsi, peppermint, black pepper, turmeric), diet, hydrotherapy, yoga, and acupuncture improve lung function.Anxiety Relief: Meditation, yoga, and lifestyle modifications promote relaxation.Stress Reduction: Yoga, meditation, acupressure, acupuncture, reflexology, and lifestyle counseling calm the mind.Advanced TherapiesPhysical TherapyReduces pain, improves movement, and enhances quality of life through techniques like electrotherapy and rehabilitation.ElectrotherapyUses electrical energy (low, medium, high-frequency currents) via devices like Ultrasound, TENS, Faradic/Galvanic stimulations, Interferential Therapy, Deep Heating Therapy, Paraffin Wax Bath, Passive Electrical Muscle Exercisers, and Laser to block pain signals and promote healing.Deep Heating TherapyDirects heat to deep tissues via electric currents, using conduction and convection to trigger heating.Benefits include:Removes accumulated toxins.Relaxes muscles and enhances circulation.Improves tissue and organ function.Used as a pre-exercise warm-up or slimming support with Passive Electrical Muscle Exercisers or Vacuum Therapy.Passive Electrical Muscle ExerciserUses electrical impulses for:Lipolysis (fat reduction) and cellulite prevention in torso, glutes, thighs, and lower abdomen.Enhancing blood flow and circulation.Reducing swelling and joint pain.Improving muscle tone and causing inch loss.Supporting muscle rehabilitation and preventing muscle mass/strength loss.Promoting natural drainage of venous blood and lymph via rhythmic contractions.Vacuum TherapyDeep tissue massage with adjustable vacuum applicators improves blood flow and oxygen to oedematous cellulite tissue, reducing facial wrinkles, toning skin, and minimizing stretch marks.Rehabilitation TherapySupports recovery from injury or illness through occupational, physical, and speech therapy to restore skills and self-sufficiency.Postural TherapyCorrects structural alignment, reducing stress on muscles and ligaments, improving strength, flexibility, and balance, and addressing degenerative joint disorders, occupational illnesses, and sedentary lifestyle issues.Fitness ProgramsCardiovascular Endurance Training: Low, medium, or high-intensity workouts (e.g., circuit training) strengthen the heart and improve oxygen utilization.Zone Exercises: Target specific areas (e.g., pelvis, upper back) with exercises like Superman, Leg Tuck, Piston Breathing, Thoracic Mobilization, Crunch Toe Touch, Cross Body Mountain Climber, and Sprint on the Spot.Additional TherapiesAcupuncture: Uses fine needles to balance 'Chi' for various conditions (recognized by WHO).Acupressure: Applies physical pressure to meridian points for ailments like headaches, migraines, and insomnia.Reflexology: Stimulates organs via foot/hand pressure points.Therapeutic Fasting: Detoxifies through controlled food abstinence, stimulating autophagy.Raw Diet Therapy: Unprocessed, plant-based foods (fruits, vegetables, sprouts, nuts) improve digestion and nutrient absorption.Bland Diet Therapy: Soft, fiber-rich, mildly seasoned foods prevent digestive irritation.Natural Botanicals: Herbs and plant extracts (e.g., flowers, seeds) prevent infection and inflammation.Organic Farm Produce: Chemical-free foods with natural fertilizers enhance healing.Chakra Mindfulness Practices: Balances seven chakras (Mooladhara to Sahasrara) to improve energy flow.Paida Lajin: Self-healing through patting (Paida) and stretching (Lajin) to clear meridians.Alkaline Water Therapy (Kangen Water): Neutralizes blood acidity, reduces blood pressure, and aids GI disorders.Agnihotra: Vedic fire ritual with rice, cow dung, and ghee in a copper pyramid purifies the atmosphere and reduces stress.Yogic HealingOverviewYogic healing, practiced by rishis and yogis for over thousands of years, restores inner balance, reflecting a person’s true nature and fostering peace from within.This holistic approach awakens the body, mind, and soul, creating a path to good health.BenefitsPhysical Health: Cures chronic illnesses, back pain, joint injuries, arthritis, obesity, hormonal imbalances, and fertility problems.Mental Well-being: Enhances inner peace and harmony.NaturopathyOverviewNaturopathy combines modern and traditional healing methods, emphasizing the body’s innate capacity to defend, repair, and heal itself.This alternative medicine uses natural therapies to address the root causes of illness, promoting long-term health and well-being.Core PrinciplesPancha Maha Bhoota Theory (Five Great Elements): The body is a unique composition of Earth, Fire, Water, Air, and Ether, treated through corresponding therapies:Prithivi Chikitsa (Mud Therapy): Element EarthJala Chikitsa (Water Therapy): Element WaterVayu Chikitsa (Air Therapy): Element AirAkasha Chikitsa (Detoxification Therapy): Element Ether (Vacuum)Surya/Agni Chikitsa (Heliotherapy): Element FireToxaemia and Morbid Matter Theory: Disease arises from poor elimination of waste matter, leading to toxin accumulation.Proper discipline and lifestyle enhance detoxification and vitality.Treatment MethodsAcupuncture & Acupressure: Balances 'Chi' (vital energy) through meridians to maintain health.Hydrotherapy: Uses water’s remedial properties (temperature, pressure, etc.) to treat ailments, aid digestion, reduce acidity, eliminate waste, regulate body temperature, and hydrate skin.Mud Therapy: Leverages mud’s minerals to retain moisture, reduce pain and inflammation, tighten skin pores, improve luster, regulate body temperature, and enhance metabolism and digestion.Massage Therapy: Skilled masseurs use rhythmic strokes and optimum pressure to relieve congestion, improve circulation, relax muscles, enhance joint mobility, and invigorate nerves.Fasting Therapy: A purificatory regimen that redirects vital energy to eliminate toxins, fostering self-control and determination.Herbal Medicine & Homeopathy: Natural remedies support healing without side effectsFrequently Asked QuestionsWhat are the benefits of naturopathy for rejuvenation?Cleansing, sleep correction, postural therapy, massage, hydrotherapy, yoga, acupuncture, and reflexology restore energy and clarity.How does naturopathy promote fitness?Personalized exercise, stretching, diet plans, and stress management improve functional capacity.What role does diet play in naturopathy?Regulates conditions like diabetes through balanced, natural nutrition.What natural treatments manage asthma?Breathing exercises, botanicals, diet, hydrotherapy, yoga, and acupuncture reduce symptoms.1.Why Is Treatment at R K Nature Cure Home Residential?Naturopathy emphasizes understanding an individual’s physiological and psychological needs based on age, the root cause of disease, and ailment chronicity.Treatment modules facilitate all physiological systems to restore normalcy and functional capacity using drugless methods.This requires a specific duration, counseling, diet reform, and a planned sequence of treatments, necessitating patient discipline and ownership.Hence, the program is purely residential, with outpatient treatment unavailable.Follow-up treatments may be offered as outpatient care if recommended by a doctor.2.How Many Days of Stay Are Advisable (Maximum and Minimum)?The minimum stay is 10 days for considerable benefits, though 5-day detoxification programs are available for Deluxe and Executive accommodation patients without acute/chronic diseases.Maximum duration depends on the individual’s condition and doctor’s advice.Naturopathy does not focus on cosmetic improvements (e.g., quantified weight loss), as outcomes vary by body type.Comprehensive counseling for conditions like obesity is provided during the first consultation.3.What Must I Bring Along?Required Documents: Identity proof (with photo), proof of residence, and a passport-size photograph.Essentials: Minimal comfortable clothes for yoga/exercise, woolen clothes (winter), personal care products, blankets, towels, water bottle, and walking shoes.Avoid: Expensive jewelry, watches, accessories, and excess cash.The home is not responsible for lost property.4.How Does Nature Cure Help with Obesity?How Much Weight Can I Lose in 10 Days?Naturopathy addresses obesity holistically, targeting underlying systemic issues rather than just symptomatic weight loss.Results vary by individual body type, so specific weight loss (e.g., 10 kg in 10 days) is not guaranteed.Suitable medical counseling on obesity treatment options is provided during the first consultation.5.Is There a Specific Time for Admissions and Discharge?Admissions: Completed between 9:00 AM - 11:00 AM.Discharge: Formalities must be completed by 3:00 PM, with a standard check-out time of 7:00 AM.Plan schedules accordingly.6.Am I Allowed to Continue Other Medicines During Treatment?Bring all prescriptions and medications currently in use.After consultation, doctors will advise on medication and dosage adjustments.7.What Are the Treatment Options at R K Nature Cure Home?Treatments are tailored post-clinical assessment and include:Hydrotherapy applicationsYogaTherapeutic Swedish MassageMud TherapyReflexologyAcupunctureExercise TherapyAromatherapyDetoxification by DietTherapeutic Juice Fasting8.Do I Need to Book Rooms in Advance?Yes, book rooms one month in advance due to limited availability.9.What Is the Mode of Payment?Payment is accepted only in cash.10.Is There a Minimum Age for Admission?Children under 10 and seniors over 70 are generally not recommended for treatment.Those under 16 or over 70 must be accompanied by family or caretakers.Admission decisions are at the discretion of the medical team.11.Do I Need to Bring My Medical Reports?Yes, bring all recent medical reports and investigations for review.Rules & RegulationsNaturopathy is a lifestyle approach requiring regulated habits and adherence to prescribed treatments for optimal health.A positive attitude and strict compliance with the following guidelines maximize benefits during and after your stay.Admission RulesReservations: Book via telephone, email, courier, or post.Advance booking is mandatory, subject to bed availability.Application Process:Obtain forms from www.rknature.com, submit signed with medical records via post, courier, or email.Separate applications required for each patient.Approval: Admission is granted only after a doctor reviews medical records and approves based on the ailment.Denial is possible at the doctor’s discretion.Confirmation: Approved patients receive a confirmation letter/email; bring a copy on arrival.Phone Bookings: Bring medical records for a doctor consultation on arrival.Physical Examination: Conducted on arrival; discrepancies with submitted records may lead to denial.Disclosure: Reveal all drug/medication use during consultation.Minimum Stay: 10 days for full benefits; 5 days for detoxification (Deluxe/Executive accommodations, non-acute cases).Date Changes: Room changes post-booking depend on availability.Identity Proof: Submit government-issued ID (passport, voter ID, driving license, PAN card, ration card, bank passbook) and a passport-size photo on arrival.Stay RulesRestrictions: Patients cannot leave the premises during their stay.Compliance: Follow prescribed treatment and diet procedures.Device Usage: Cell phones, laptops, cameras, and iPods are prohibited in treatment sections, yoga halls, and dining areas.Conduct: Adhere to session-specific rules.Doctor Consultations: Meet doctors daily in consulting rooms at allotted times; avoid their residences (contact security in emergencies).Dress Code: Wear dignified, loose-fitting clothes; short skirts/pants are not allowed for women.Transactions: No money exchanges with staff or use of staff for external purchases.Tips/Gifts: Not permitted individually; use the tip box.Peaceful Environment: Maintain harmony; retire by 9:00 PM (no chit-chatting after hours).Property Care: Handle hospital belongings carefully (reimburse damages); switch off lights, fans, and AC when not in use; keep rooms tidy.Discipline: Strict adherence to rules is mandatory; non-compliance may lead to discharge at management’s discretion.Terms and ConditionsTreatment Duration: Complete the advised treatment period for maximum benefit.Prohibited Items: Tea, coffee, snuff, paan, tobacco, smoking, and alcohol are strictly banned.Outside Food: Forbidden; violators will be discharged without inquiry.Occupancy: Only admitted patients and approved helpers/attenders (at doctor’s discretion) may stay.Helpers follow the patient diet; no external food allowed.Visitors: Allowed during 12:00 PM - 1:00 PM and 6:00 PM - 7:00 PM, with patient consent.Valuables: Avoid bringing jewelry or valuables; management is not liable for losses.Deposit cash at reception (withdraw as needed); credit/debit card payments encouraged.Amenities: Bed linen and pillows provided; additional items available at the store.Parking: Vehicles can be parked on-site during the stay.Contact DetailsR K NATURE CURE HOMENo.12 Krishna Layout, Ganapathy,Behind Roots Group of Companies,Coimbatore - 641006.+91 88700-666220422 2332111enquiry@rknature.comHello! Welcome to RK Nature Cure Home.We have a wonderful variety of accommodation options to suit your needs during your stay with us.You can choose from our Deluxe Double Room in the RK Block, perfect for a comfortable and spacious experience, or the Executive Double Room in the Sakthi Amma Block for a slightly cozier yet elegant stay.We also offer Standard Double Rooms with air conditioning in both the Sakthi Amma and Swami Satchidananda Blocks, ideal for a pleasant and cool environment.For families or small groups, our Family Suite in the Swami Satchidananda Block is a great choice, and we have a Standard Triple Room with A/C in the same block for those traveling together.If you’re looking for something simpler, the Nest Block offers a peaceful, no-frills option, while the KM Block provides both air-conditioned and non-air-conditioned Standard Double Rooms to match your preference.Each option comes with therapeutic meals, morning yoga, and essential treatments to support your healing journeyAccommodation Types and Charges (Per Day)Deluxe Double Room (RK Block)Single Occupancy: ₹4000Sharing Occupancy:₹3000 per person (1st and 2nd persons)₹1000 (3rd person)Attendant: ₹750Executive Double Room (Sakthi Amma Block)Single Occupancy: ₹3000Sharing Occupancy:₹1850 per person (1st and 2nd persons)₹1000 (3rd person)Attendant: ₹750Standard Double A/C Room (Sakthi Amma Block)Single Occupancy: ₹2500Sharing Occupancy:₹1400 per person (1st and 2nd persons)₹1000 (3rd person)Attendant: ₹750Family Suite (Swami Satchidananda Block)Single Occupancy: ₹3000Sharing Occupancy: ₹1500 per person (1st, 2nd, and 3rd persons)Attendant: ₹750Standard Triple A/C Room (Swami Satchidananda Block)Sharing Occupancy Only: ₹1200 per person (1st, 2nd, and 3rd persons)Attendant: Not applicableStandard Double A/C Room (Swami Satchidananda Block)Single Occupancy: ₹2500Sharing Occupancy: ₹1400 per person (1st and 2nd persons)Attendant: ₹750Nest BlockSingle Occupancy: ₹1800Sharing Occupancy: ₹1100 per person (1st and 2nd persons)Attendant: Not applicableKM BlockSingle Occupancy: ₹2500Sharing Occupancy:₹1400 per person (1st and 2nd persons)₹1000 (3rd person)Attendant: ₹750Standard Double Non-A/C Room (KM Block)Single Occupancy: ₹2000Sharing Occupancy:₹1100 per person (1st and 2nd persons)₹1000 (3rd person)Attendant: ₹750Important NotesIncluded in Daily Charges:AccommodationTherapeutic food twice daily (11 AM and 6 PM, as prescribed)Morning general yogaENT washEnemaMudpack (morning and evening)Additional Charges: Special treatments (e.g., physiotherapy, stretching, dynamic exercises, gym sessions, clinical yoga therapy) are charged separately if prescribed.Attendant Fees: Charged as per room tariff if recommended by a doctor.Treatment Packages and ChargesRK Nature Cure Home offers various treatments prescribed by doctors.Charges are as follows:Acupuncture with Stimulator: ₹250Full Body Application (Leaves, Fenugreek, or Aloe Vera): ₹500Partial Application (Fenugreek or Aloe Vera): ₹250Application (Turmeric, Kanji, Kadukai, Coconut Oil): ₹400Aroma Therapy: ₹1500Asthma Bath: ₹250Full Body Toning (Aroma Massage, Steam, Papaya/Badam Pack): ₹1800Castor Oil Pack: ₹150Compressive Air Therapy: ₹400Facial Therapy: ₹500Face Pack: ₹150Green Former Treatment: ₹500Henna Application: ₹300Immersion Bath: ₹200Special Immersion Bath: ₹250Herbal Mud Bath: ₹400Jet Bath: ₹300Liver Flush Treatment: ₹1400Lagoo Shanka Prakshalana (LSP): ₹300Aroma Oil Massage: ₹1300Olive Oil Massage: ₹1400Sesame Oil Massage: ₹1100Full Body Massage with Aloe Vera: ₹1200Partial Massage with Aloe Vera: ₹600Herbal Powder and Herbal Oil Massage: ₹1700Multani Mud Bath: ₹400Plantain Leaf Bath: ₹300Sauna Bath: ₹300Steam Bath: ₹250Vacuum Therapy: ₹550Vibro Massage: ₹500Full Poultice Massage: ₹1600Kadivasthi (Partial): ₹700Full Salt Glow Massage: ₹1300Hip Bath (Jacuzzi): ₹100Spinal Spray (Sitting): ₹100Foot and Arm Bath: ₹100Partial Massage: ₹600Head Wash: ₹50Full Hot and Cold Compress: ₹50Hot and Cold Foot Bath or Arm Bath: ₹50Partial Mud Paste Application: ₹150Partial Herbal Mud Paste Application: ₹200Free Treatments: Spinal Bath, Spinal Spray, Facial Steam with TulasiPartial Herbal Paste Application: ₹150Payment DetailsReservation DepositStandard Sharing Rooms and Nest Rooms: ₹1000Executive and Deluxe Accommodation: ₹5000Payment Methods: Card, Cash, NEFT, or DD in favor of 'RK Nature Cure Home,' payable at Coimbatore.BillingAdvance Payment: Collected at admission based on accommodation type and stay duration.Treatment Charges: Collected weekly along with miscellaneous charges.Final Settlement: Payable by Card or Cash.Additional ChargesLaundry, internet usage, room service, gym, physiotherapy, oral medicines, special treatments, and other requested services are charged separately.Fee StructureManagement reserves the right to revise/change fees without prior notice.Cancellation and Discharge PoliciesCancellation of Confirmed BookingRefund Criteria (Based on Working Hours: 9 AM - 5 PM IST):Before 3 days: 75% refundBefore 2 days: 50% refundBefore 1 day: 25% refundWithin 24 hours: Full deposit forfeitedEarly DischargeNotice Period: Must be intimated at least 3 days in advance.Urgent Discharge Charges:If 2 or more days remain: 2 days’ room chargesIf 1 day remains: 1 day’s room chargesContact DetailsR K NATURE CURE HOMENo.12 Krishna Layout, Ganapathy,Behind Roots Group of Companies,Coimbatore - 641006.+91 88700-666220422 2332111enquiry@rknature.com"
        
        prompt = (
            f"You are Priya, a warm receptionist at RK Nature Cure Home. Answer concisely, maintaining a caring tone. "
            f"Context: '{context}'. Previous conversation: '{summary}'. User query: '{query}'."
        )
        
        response = client.models.generate_content(
            model="gemini-2.0-flash",
            contents=[prompt]
        ).text.strip()
        
        if "User: Unknown" in summary and "Phone: Unknown" in summary:
            response += " Please tell us your name and number to help better."
        elif "User: Unknown" in summary:
            response += " Please tell us your name to help better."
        elif "Phone: Unknown" in summary:
            response += " Please tell us your number to help better."
        
        return response
    finally:
        await conn.close()

# Flask route to handle user queries
@app.route('/submit_query', methods=['POST'])
async def submit_query():
    data = request.get_json()
    user_query = data.get('Query')
    session_id = data.get('SessionId')
    
    if not user_query or not session_id:
        return jsonify({"error": "Missing Query or SessionId!"}), 400
    
    response = await generate_representative_response(session_id, user_query)
    
    # Log the conversation with all required arguments
    await log_chat_and_update_summary(session_id, f"User: {user_query} | Bot: {response}", user_query)
    
    return jsonify({"response": response, "SessionId": session_id})

if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0', port=8000)
